$.tools.validator.addEffect("depageEffect",function(a){$.each(a,function(a,c){var d=$(c.input).parents("p");$errorMessage=d.find(".errorMessage");0===$errorMessage.length?(d.append('<span class="errorMessage">'+d.attr("data-errorMessage")+"</span>"),d.addClass("error")):$errorMessage.show()})},function(a){$.each(a,function(a,c){var d=$(c).parents("p");d.removeClass("error");d.find(".errorMessage").remove()})});
$(document).ready(function(){$(".depage-form").each(function(){var a=this,b=$(this),c=b.attr("data-jsvalidation"),d=b.attr("data-jsautosave");"blur"==c||"change"==c?b.validator({effect:"depageEffect",inputEvent:c,errorInputEvent:c}):"submit"==c&&b.validator({effect:"depageEffect",errorInputEvent:null});b.bind("onFail",function(){b.find(".submit").addClass("error")});b.bind("onSuccess",function(){0<b.find(".errorMessage").length?b.find(".submit").addClass("error"):b.find(".submit").removeClass("error")});
b.delegate(".error input","focus",function(){$(this).parents(".error").find(".errorMessage").hide()});if("true"==d){var e=new Date;a.data=a.data||{};a.data.saving=!1;a.data.lastsave=e.getTime();a.data.timer=null;a.data.autosave=function(){var b={};$("input, select, textarea",a).each(function(){var a=$(this).attr("type");"radio"==a||"checkbox"==a?this.checked&&(b[this.name]=this.value):b[this.name]=this.value});b.formAutosave="true";a.data.saving=!0;$.post(a.action,b,function(){e=new Date;a.data.lastsave=
e.getTime();a.data.saving=!1})};a.data.changed=function(b){e=new Date;clearTimeout(a.data.timer);a.data.saving||(b||1E3<e.getTime()-a.data.lastsave?a.data.autosave():setTimeout(function(){a.data.changed()},1E3))};$("input, select, textarea",a).change(function(){a.data.changed(!0)});$("textarea",a).keyup(function(){a.data.changed()})}$(".input-textarea",a).each(function(){var a=$.parseJSON($(this).attr("data-textarea-options")),b=$("textarea",this),c=$('<textarea class="textarea-size"></textarea>').appendTo(b.parent()).height("auto").css({position:"absolute",
left:"-10000px"});a.autogrow&&!($.browser.msie&&9>parseInt($.browser.version,10))&&(b.autogrow=function(){c[0].value=b[0].value;b.height(c[0].scrollHeight+30)},b.mouseup(function(){}).keyup(function(){b.autogrow()}).keydown(function(){b.autogrow()}).scroll(function(){b.autogrow()}).autogrow())});$(".input-richtext",a).each(function(){var a=$.parseJSON($(this).attr("data-textarea-options"))||$.parseJSON($(this).attr("data-richtext-options"));$("textarea",this).depageEditor(a)});$("input[autofocus]:first",
a).focus();$("input[type='url']",a).change(function(){""!=this.value&&!this.value.match(/[a-z][\w-]+:\/\/.*/)&&(this.value="http://"+this.value)});$("input[type='file']",a).depage_uploader()})});
